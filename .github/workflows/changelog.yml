name: Generate Changelog

on:
  push:
    tags:
      - 'v*'  # –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ –ª—é–±—ã–µ —Ç–µ–≥–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å 'v'
  workflow_dispatch:

jobs:
  generate_changelog:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

      - name: Generate CHANGELOG.md
        uses: mikepenz/release-changelog-builder-action@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          toTag: v1.0.0    # –í–∞—à —Ç–µ–∫—É—â–∏–π —Ç–µ–≥
          configuration: |
            categories:
              - title: "üöÄ New Features"
                labels: ["feature", "enhancement"]
              - title: "üêõ Bug Fixes"
                labels: ["bug", "fix"]
              - title: "üìö Other Changes"
                labels: ["*"]  # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

      - name: Verify and Commit
        run: |
          if [ -f "CHANGELOG.md" ]; then
            echo "Changelog content:"
            head -n 20 CHANGELOG.md  # –ü–æ–∫–∞–∂–µ–º –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
            git config --global user.name "GitHub Actions"
            git config --global user.email "actions@github.com"
            git add CHANGELOG.md
            git commit -m "Automatic changelog update for v1.0.0"
            git push
          else
            echo "Error: CHANGELOG.md not generated!"
            echo "Possible reasons:"
            echo "1. No closed PRs/issues found"
            echo "2. Configuration error"
            exit 1
          fi
